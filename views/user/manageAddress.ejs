<!DOCTYPE html>
<html lang="zxx">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Male_Fashion Template" />
    <meta name="keywords" content="Male_Fashion, unica, creative, html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Male-Fashion | Template</title>

    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="css/elegant-icons.css" type="text/css" />
    <link rel="stylesheet" href="css/magnific-popup.css" type="text/css" />
    <link rel="stylesheet" href="css/nice-select.css" type="text/css" />
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css" />
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css" />
    <link rel="stylesheet" href="css/style.css" type="text/css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <style>
      a {
        text-decoration: none;
      }

      .menu-itemmm {
        margin-bottom: 20px;
        padding-left: 21px;
      }

      .menu-itemmm a {
        color: black;
        text-decoration: none;
        text-transform: capitalize;
        font-size: 0.9rem;
        font-family: "Quicksand";
      }

      .menu-headinggg {
        font-size: 0.7rem;
        font-weight: bold;
        margin-bottom: 10px;
        color: rgba(127, 127, 127, 1);
        padding-left: 10px;
      }

      .action {
        display: none;
      }

      .dot:hover .action {
        display: block;
      }
    </style>
  </head>

  <body class="bg-body-tertiary">
    <%- include('../partials/nav.ejs') -%>
    <div class="container bg-body-tertiary" style="background-color: #fff">
      <div class="container-fluid">
        <div class="row">
          <%- include('../partials/profileNav.ejs') -%>

          <div
            class="col-md-9"
            id="addressArray"
            style="margin-top: 1rem"
            data-address="<%= JSON.stringify(address)%>"
          >
            <div
              class="div"
              style="
                background-color: #fff;
                box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.08);
                padding: 16px;
              "
            >
              <div style="margin: 1rem 2rem; margin-bottom: 1rem">
                <h5 style="padding: 2px">Manage address</h5>
              </div>
              <div
                id="address"
                onclick="addAddress()"
                class="bg-body-tertiary"
                style="
                  border: 2px solid rgb(159, 159, 181);
                  margin-top: 2rem 1rem;
                  padding: 16px;
                "
              >
                <div class="bg-body-tertiary d-flex">
                  <span class="me-2"
                    ><i
                      class="fa-solid fa-plus fa-lg"
                      style="color: #1660df"
                    ></i
                  ></span>
                  <h5>Add new address</h5>
                </div>
              </div>
              <div>
                <div
                  id="form"
                  class="col-6"
                  style="display: none; margin-bottom: 2rem"
                >
                  <div
                    class="checkout__form"
                    style="width: 500px; height: 500px; padding: 20px"
                  >
                    <form action="/add-Address" method="post">
                      <div class="row">
                        <div class="mb-3 col-6">
                          <label for="firstname" class="form-label"
                            >First Name<span>*</span></label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="firstname"
                            name="fname"
                          />
                          <input
                            type="text"
                            name="account"
                            hidden
                            value="true"
                            id=""
                          />
                        </div>

                        <div class="mb-3 col-6">
                          <label for="lastName" class="form-label"
                            >Last Name<span>*</span></label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="lastName"
                            name="lname"
                          />
                        </div>

                        <div class="mb-3 col-6">
                          <label for="country" class="form-label"
                            >Country<span>*</span></label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="country"
                            name="country"
                            value="India"
                          />
                        </div>

                        <div class="mb-3 col-6">
                          <label for="address" class="form-label"
                            >Address<span>*</span></label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="address"
                            name="address"
                            placeholder="Street Address"
                          />
                        </div>

                        <div class="row mb-3">
                          <div class="col-lg-6">
                            <label for="city" class="form-label"
                              >Town/City<span>*</span></label
                            >
                            <input
                              type="text"
                              class="form-control"
                              id="city"
                              name="city"
                            />
                          </div>
                          <div class="col-lg-6">
                            <label for="state" class="form-label"
                              >State<span>*</span></label
                            >
                            <input
                              type="text"
                              class="form-control"
                              id="state"
                              name="state"
                            />
                          </div>
                        </div>

                        <div class="mb-3 col-6">
                          <label for="pin" class="form-label"
                            >Postcode / ZIP<span>*</span></label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="pin"
                            name="pin"
                          />
                        </div>

                        <div class="row mb-3">
                          <div class="col-lg-6">
                            <label for="Phone" class="form-label"
                              >Phone<span>*</span></label
                            >
                            <input
                              type="text"
                              class="form-control"
                              id="Phone"
                              name="phone"
                            />
                          </div>
                          <div class="col-lg-6">
                            <label for="email" class="form-label"
                              >Email<span>*</span></label
                            >
                            <input
                              type="text"
                              class="form-control"
                              id="email"
                              name="email"
                            />
                          </div>
                        </div>
                        <div class="d-flex justify-content-between">
                          <button
                            type="submit "
                            style="flex-grow: 1; margin-right: 0.5rem"
                            class="btn btn-dark btn-sm"
                          >
                            Add
                          </button>
                          <button
                            type="button"
                            style="flex-grow: 1"
                            id="cancel"
                            class="btn btn-dark btn-sm"
                          >
                            Cancel
                          </button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              <div>
                <div
                  id="editForm"
                  class="col-6"
                  style="display: none; margin-bottom: 2rem"
                >
                  <div
                    class="checkout__form"
                    style="width: 500px; height: 500px; padding: 20px"
                  >
                    <form action="/edit-Address?_method=PUT" method="post">
                      <div class="row">
                        <div class="mb-3 col-6">
                          <label for="firstname" class="form-label"
                            >First Name<span>*</span></label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="editFirstname"
                            name="fname"
                          />
                          <input
                            type="text"
                            class="form-control"
                            id="index"
                            name="index"
                          />
                        </div>

                        <div class="mb-3 col-6">
                          <label for="lastName" class="form-label"
                            >Last Name<span>*</span></label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="editLastName"
                            name="lname"
                          />
                        </div>

                        <div class="mb-3 col-6">
                          <label for="country" class="form-label"
                            >Country<span>*</span></label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="country"
                            name="country"
                            value="India"
                          />
                        </div>

                        <div class="mb-3 col-6">
                          <label for="address" class="form-label"
                            >Address<span>*</span></label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="editAddress"
                            name="address"
                            placeholder="Street Address"
                          />
                        </div>

                        <div class="row mb-3">
                          <div class="col-lg-6">
                            <label for="city" class="form-label"
                              >Town/City<span>*</span></label
                            >
                            <input
                              type="text"
                              class="form-control"
                              id="editCity"
                              name="city"
                            />
                          </div>
                          <div class="col-lg-6">
                            <label for="state" class="form-label"
                              >State<span>*</span></label
                            >
                            <input
                              type="text"
                              class="form-control"
                              id="editState"
                              name="state"
                            />
                          </div>
                        </div>

                        <div class="mb-3 col-6">
                          <label for="pin" class="form-label"
                            >Postcode / ZIP<span>*</span></label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="editPin"
                            name="pin"
                          />
                        </div>

                        <div class="row mb-3">
                          <div class="col-lg-6">
                            <label for="Phone" class="form-label"
                              >Phone<span>*</span></label
                            >
                            <input
                              type="text"
                              class="form-control"
                              id="editPhone"
                              name="phone"
                            />
                          </div>
                          <div class="col-lg-6">
                            <label for="email" class="form-label"
                              >Email<span>*</span></label
                            >
                            <input
                              type="text"
                              class="form-control"
                              id="editEmail"
                              name="email"
                            />
                          </div>
                        </div>

                        <div class="d-flex justify-content-between">
                          <button
                            type="submit "
                            style="flex-grow: 1; margin-right: 0.5rem"
                            class="btn btn-dark btn-sm"
                          >
                            Edit
                          </button>
                          <button
                            type="button"
                            onclick="return deleteAddress();"
                            style="flex-grow: 1"
                            id="editCancel"
                            class="btn btn-dark btn-sm"
                          >
                            Cancel
                          </button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>

              <div id="reload-area">
                <%if(address) {%> <%address.forEach((el, i)=> {%>

                <div
                  class="bg-body-tertiary"
                  style="
                    border: 2px solid rgb(159, 159, 181);
                    margin: 2rem 0;
                    padding: 16px;
                  "
                >
                  <div
                    class=""
                    style="display: flex; justify-content: space-between"
                  >
                    <div>Address <%= i + 1 %></div>

                    <div class="dot" style="position: relative">
                      <span class="text-end"
                        ><i
                          class="fa-solid fa-ellipsis-vertical fa-lg"
                          style="color: #054ecc"
                        ></i
                      ></span>
                      <div
                        class="action ac<%= i%>"
                        style="
                          position: absolute;
                          top: 4px;
                          left: -60px;
                          display: none;
                          background-color: #fff;
                          box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.08);
                          display: flex;
                          justify-content: center;
                          align-items: center;
                        "
                      >
                        <ul
                          style="
                            list-style: none;
                            text-align: center;
                            margin-right: 10px;
                            padding-left: 12px;
                            padding-top: 5px;
                          "
                        >
                          <li>
                            <button
                              type="button"
                              onclick="editAddress('<%= i%>')"
                              class="page-link"
                            >
                              edit
                            </button>
                          </li>
                          <li>
                            <button
                              class="page-link"
                              onclick="deleteAddress('<%= i%>')"
                            >
                              Delete
                            </button>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div>
                    <p style="margin: 0">
                      <span> <%= el.fullName%> </span>
                      <span> <%= el.phone%> </span>
                    </p>
                    <p style="margin: 0"><%= el.address%> - <%= el.pincode%></p>
                  </div>
                </div>
                <%})%> <%}%>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <%- include('../layout/userTemplateFooter.ejs') -%>

    <script src="/assets/js/vendors/jquery-3.6.0.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
  </body>
</html>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Your code here
  });
  const myForm = document.getElementById("form");
  const btn = document.getElementById("address");
  function addAddress() {
    btn.addEventListener("click", () => {
      myForm.style.display = "block";
      btn.style.display = "none";
    });
  }

  document.getElementById("cancel").addEventListener("click", () => {
    myForm.style.display = "none";
    btn.style.display = "block";
  });

  const editForm = document.getElementById("editForm");
  document.getElementById("editCancel").addEventListener("click", () => {
    editForm.style.display = "none";
    btn.style.display = "block";
  });

  const action = document.querySelectorAll(".dot");
  const btns = document.querySelectorAll(".action").forEach((el) => {
    el.style.display = "none";
  });

  action.forEach((el, i) => {
    el.addEventListener("mouseover", () => {
      document.querySelectorAll(`.ac${i}`).forEach((el) => {
        el.style.display = "block";
      });
    });

    el.addEventListener("mouseout", () => {
      document.querySelectorAll(`.ac${i}`).forEach((el) => {
        el.style.display = "none";
      });
    });
  });

  function editAddress(index) {
    console.log("revice");
    const addresses = JSON.parse(
      document.getElementById("addressArray").getAttribute("data-address")
    );

    const address = addresses[index];
    console.log("adresss", address);
    const myForm = document.getElementById("editForm");
    myForm.style.display = "block";
    btn.style.display = "none";
    const [fisrtName, lastName] = address.fullName.split(" ");
    console.log(fisrtName);
    document.getElementById("editFirstname").value = fisrtName;
    document.getElementById("editLastName").value = lastName;
    document.getElementById("country").value = address.country;
    document.getElementById("editAddress").value = address.address;
    document.getElementById("editCity").value = address.city;
    document.getElementById("editCity").value = address.city;
    document.getElementById("editState").value = address.state;
    document.getElementById("editPin").value = address.pincode;
    document.getElementById("editPhone").value = address.phone;
    document.getElementById("editEmail").value = address.email;
    document.getElementById("index").value = index;
  }

  function deleteAddress(index) {
    console.log("delete");
    if (!index) {
      return;
    }

    Swal.fire({
      title: "Are you sure",
      text: `do you want to delete address ${parseInt(index) + 1}!`,
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "Yes!",
    }).then((response) => {
      if (response.isConfirmed) {
        const data = {
          index,
        };
        $.ajax({
          type: "DELETE",
          url: `/delete-address/${index}`,
          success: (response) => {
            if (response.success) {
              window.location.reload();
            }
          },
        });
      }
    });
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
