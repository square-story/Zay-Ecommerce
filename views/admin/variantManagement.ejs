<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Nest Dashboard</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="" />
    <meta property="og:type" content="" />
    <meta property="og:url" content="" />
    <meta property="og:image" content="" />
    <!-- Favicon -->
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="assets/imgs/theme/favicon.svg"
    />
    <!-- Template CSS -->
    <link href="/assets/css/main.css?v=1.1" rel="stylesheet" type="text/css" />
  </head>

  <body>
    <%- include('../partials/sidenav.ejs') -%>
    <main class="main-wrap">
      <section class="content-main">
        <div class="content-header">
          <h2 class="content-title">Variant</h2>
          <div>
            <button
              href="#"
              data-bs-toggle="modal"
              data-bs-target="#exampleModal"
              data-bs-whatever="@mdo"
              class="btn btn-dark"
            >
              <i class="material-icons md-plus"></i>Add variant
            </button>
          </div>

          <div
            class="modal fade"
            id="exampleModal"
            tabindex="-1"
            aria-labelledby="exampleModalLabel"
            aria-hidden="true"
          >
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h1 class="modal-title fs-5" id="exampleModalLabel">
                    Add variant
                  </h1>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                  ></button>
                </div>
                <div class="modal-body">
                  <form
                    action="/admin/addVariant"
                    onsubmit="return variantValidate()"
                    method="post"
                    id="myform"
                    enctype="multipart/form-data"
                  >
                    <div class="row">
                      <div class="col-lg-4">
                        <div class="mb-4">
                          <label class="form-label">Regular price</label>
                          <div class="row gx-2">
                            <input
                              type="text"
                              name="id"
                              hidden
                              value="<%= product._id %>"
                            />
                            <input
                              placeholder="₹"
                              name="price"
                              id="price"
                              type="text"
                              class="form-control"
                            />
                          </div>
                        </div>
                      </div>
                      <div class="col-lg-4">
                        <div class="mb-4">
                          <label class="form-label">Offer price</label>
                          <input
                            placeholder="₹"
                            id="offerPrice"
                            name="offerPrice"
                            type="text"
                            class="form-control"
                          />
                        </div>
                      </div>
                      <div class="col-lg-4">
                        <div class="mb-4">
                          <label class="form-label">Color</label>
                          <input
                            placeholder="eg:- red, green, yellow"
                            id="color"
                            name="color"
                            type="text"
                            class="form-control"
                          />
                        </div>
                      </div>
                      <div class="col-lg-4">
                        <div class="mb-4">
                          <label class="form-label">Stock</label>
                          <input
                            placeholder="Add stock"
                            id="stock"
                            name="stock"
                            type="text"
                            class="form-control"
                          />
                        </div>
                      </div>
                    </div>

                    <label class="form-label">Add Size</label>

                    <div
                      class="row"
                      style="margin-left: 1rem; margin-bottom: 1rem"
                    >
                      <div class="form-check col-lg-2">
                        <input
                          class="form-check-input"
                          name="size"
                          type="checkbox"
                          value="S"
                          id="defaultCheck1"
                        />
                        <label class="form-check-label" for="defaultCheck1">
                          S
                        </label>
                      </div>
                      <div class="form-check col-lg-2">
                        <input
                          class="form-check-input"
                          name="size"
                          type="checkbox"
                          value="M"
                          id="defaultCheck1"
                        />
                        <label class="form-check-label" for="defaultCheck1">
                          M
                        </label>
                      </div>
                      <div class="form-check col-lg-2">
                        <input
                          class="form-check-input"
                          name="size"
                          type="checkbox"
                          value="L"
                          id="defaultCheck1"
                        />
                        <label class="form-check-label" for="defaultCheck1">
                          L
                        </label>
                      </div>
                      <div class="form-check col-lg-2">
                        <input
                          class="form-check-input"
                          name="size"
                          type="checkbox"
                          value="XL"
                          id="defaultCheck1"
                        />
                        <label class="form-check-label" for="defaultCheck1">
                          XL
                        </label>
                      </div>
                      <div class="form-check col-lg-2">
                        <input
                          class="form-check-input"
                          name="size"
                          type="checkbox"
                          value="XXL"
                          id="defaultCheck1"
                        />
                        <label class="form-check-label" for="defaultCheck1">
                          XXL
                        </label>
                      </div>
                    </div>

                    <label class="form-label">Add images</label>

                    <div class="" style="display: flex; margin: 1rem">
                      <%for(let i=0; i < 4; i++) {%>

                      <div class="mb-4 col-lg-3 me-2">
                        <img
                          id="imagePreview2<%= i %>"
                          alt="Product image"
                          style="
                            width: 100px;
                            height: 100px;
                            margin-bottom: 1.5rem;
                          "
                        />

                        <input
                          type="file"
                          accept="image/*"
                          placeholder="Add image"
                          name="images"
                          onclick="previewImage2(this, 'imagePreview2<%= i %>')"
                          class="form-control"
                          id="image<%= i + 1%>"
                        />
                      </div>

                      <%}%>
                    </div>

                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal"
                      >
                        Close
                      </button>
                      <button type="submit" class="btn btn-dark">
                        Send message
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card mb-4">
          <header class="card-header">
            <div class="row gx-3">
              <div class="col-lg-4 col-md-6 me-auto">
                <input
                  type="text"
                  placeholder="Search..."
                  class="form-control"
                />
              </div>
              <div class="col-lg-2 col-md-3 col-6">
                <select class="form-select">
                  <option>Status</option>
                  <option>Active</option>
                  <option>Disabled</option>
                  <option>Show all</option>
                </select>
              </div>
              <div class="col-lg-2 col-md-3 col-6">
                <select class="form-select">
                  <option>Show 20</option>
                  <option>Show 30</option>
                  <option>Show 40</option>
                </select>
              </div>
            </div>
          </header>
          <!-- card-header end// -->
          <div class="card-body">
            <div class="table-responsive" id="Reload">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Index</th>
                    <th>images</th>
                    <th>Name</th>
                    <th>Color</th>
                    <th>Stock</th>
                    <th>Price</th>
                    <th>OfferPrice</th>
                    <th>Size</th>
                    <th class="text-end">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <% if(product.variant.length> 0) {%> <%
                  product.variant.map((item, i)=> {%>
                  <tr>
                    <td><%= i + 1 %></td>
                    <td width="40%">
                      <a href="#" class="itemside">
                        <% for(let i=0; i < item.images.length; i++) {%>

                        <div class="left me-2">
                          <img
                            src="/img/productImage/<%= item.images[i] %>"
                            class="img-sm"
                            alt="Userpic"
                          />
                        </div>

                        <%}%>
                      </a>
                    </td>
                    <td><%= product.name %></td>
                    <td><%= item.color %></td>
                    <td><%= item.stock %></td>
                    <td><%= item.price %></td>
                    <td><%= item.offerPrice %></td>

                    <td><%= item.size %></td>

                    <td class="text-end">
                      <a
                        id="button"
                        href="/admin/edit-variant?index=<%= i %>&id=<%= product._id %>"
                        class="btn btn-sm btn-dark font-sm"
                      >
                        Edit
                      </a>
                    </td>
                  </tr>

                  <% }) %> <% }else{ %>
                  <tr>
                    <td colspan="5">No user found</td>
                  </tr>
                  <% } %>
                </tbody>
              </table>
              <!-- table-responsive.// -->
            </div>
          </div>

          <!-- card-body end// -->
        </div>
        <!-- card end// -->
        <div class="pagination-area mt-15 mb-50">
          <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-start">
              <li class="page-item active">
                <a class="page-link" href="#">01</a>
              </li>
              <li class="page-item"><a class="page-link" href="#">02</a></li>
              <li class="page-item"><a class="page-link" href="#">03</a></li>
              <li class="page-item">
                <a class="page-link dot" href="#">...</a>
              </li>
              <li class="page-item"><a class="page-link" href="#">16</a></li>
              <li class="page-item">
                <a class="page-link" href="#"
                  ><i class="material-icons md-chevron_right"></i
                ></a>
              </li>
            </ul>
          </nav>
        </div>
      </section>
      <!-- content-main end// -->
      <%- include('../partials/adminFooter.ejs') -%>
    </main>

    <script src="/assets/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="/assets/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/vendors/select2.min.js"></script>
    <script src="/assets/js/vendors/perfect-scrollbar.js"></script>
    <script src="/assets/js/vendors/jquery.fullscreen.min.js"></script>
    <!-- // sweat alert -->
    <script src="/node_modules/sweetalert2/dist/sweetalert2.all.min.js"></script>
    <!-- Main Script -->
    <script src="/assets/js/main.js?v=1.1" type="text/javascript"></script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
  </body>
</html>

<script>
  function previewImage(input, imageId) {
    const preview = document.getElementById(imageId);
    const file = input.files[0];

    if (file) {
      const reader = new FileReader();

      reader.onload = function (e) {
        preview.src = e.target.result;
      };

      reader.readAsDataURL(file);
    } else {
      preview.src = "#";
    }
  }

  function previewImage2(input, imageId) {
    const preview = document.getElementById(imageId);
    const file = input.files[0];

    if (file) {
      const reader = new FileReader();

      reader.onload = function (e) {
        preview.src = e.target.result;
      };

      reader.readAsDataURL(file);
    } else {
      preview.src = "#";
    }
  }
</script>

<script>
  function variantValidate() {
    let price = document.getElementById("price");
    let oprice = document.getElementById("offerPrice");
    let color = document.getElementById("color");
    let stock = document.getElementById("stock");
    let image = document.getElementById("image1");

    if (
      price.value.trim() === "" ||
      Number(price.value) <= 0 ||
      isNaN(price.value)
    ) {
      price.style.border = "solid 1px red";

      setTimeout(function () {
        price.style.border = "";
      }, 3000);
      return false;
    } else if (
      oprice.value.trim() === "" ||
      Number(oprice.value) <= 0 ||
      isNaN(oprice.value)
    ) {
      oprice.style.border = "solid 1px red";

      setTimeout(function () {
        oprice.style.border = "";
      }, 3000);
      return false;
    } else if (color.value.trim() === "") {
      color.style.border = "solid 1px red";

      setTimeout(function () {
        color.style.border = "";
      }, 3000);
      return false;
    } else if (
      stock.value.trim() === "" ||
      Number(stock.value) <= 0 ||
      isNaN(stock.value)
    ) {
      stock.style.border = "solid 1px red";

      setTimeout(function () {
        stock.style.border = "";
      }, 3000);
      return false;
    } else {
      true;
    }
  }
</script>
